# Copyright 2023 The Google Research Authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

"""Utility library of instructions."""

import functools
import random
import re

import immutabledict
import nltk
import pkg_resources
from packaging import version


# Downloading 'punkt' with nltk<3.9 has a remote code vuln.
# see  https://github.com/EleutherAI/lm-evaluation-harness/issues/2210
# and https://github.com/nltk/nltk/issues/3266
# for more information.
NLTK_MIN_VERSION = "3.9.1"


def download_nltk_resources():
    """Download 'punkt' if not already installed"""
    nltk_version = pkg_resources.get_distribution("nltk").version
    assert (
        version.parse(nltk_version) >= version.parse(NLTK_MIN_VERSION)
    ), f"`nltk` version {nltk_version} is not >= {NLTK_MIN_VERSION}. Please update `nltk` before proceeding--older versions are vulnerable to a remote code execution vulnerability."

    try:
        nltk.data.find("tokenizers/punkt_tab")
    except LookupError:
        nltk.download("punkt_tab")


download_nltk_resources()

WORD_LIST = [
    "västra",
    "döma",
    "signal",
    "dumpa",
    "fläck",
    "motsatt",
    "botten",
    "potatis",
    "administration",
    "arbetssätt",
    "välkomna",
    "morgon",
    "bra",
    "byrå",
    "primär",
    "önskan",
    "ansvar",
    "trycka",
    "problem",
    "president",
    "stjäla",
    "borsta",
    "läsa",
    "typ",
    "slå",
    "tränare",
    "tillväxt",
    "låsa",
    "ben",
    "fall",
    "lika",
    "bekväm",
    "område",
    "ersättning",
    "prestanda",
    "para",
    "promenad",
    "medicin",
    "filma",
    "sak",
    "sten",
    "knacka",
    "total",
    "konkurrens",
    "lätthet",
    "söder",
    "etablering",
    "samla",
    "parkering",
    "värld",
    "massor",
    "andetag",
    "krav",
    "alkohol",
    "handel",
    "kär",
    "markera",
    "gata",
    "materia",
    "beslut",
    "röra",
    "avtal",
    "studio",
    "tränare",
    "hjälpa",
    "hjärna",
    "vinge",
    "stil",
    "privat",
    "bästa",
    "brun",
    "ben",
    "köpa",
    "förfarande",
    "metod",
    "hastighet",
    "hög",
    "företag",
    "värde-",
    "paj",
    "analytiker",
    "session",
    "mönster",
    "distrikt",
    "nöje",
    "middag",
    "simning",
    "skämt",
    "beställa",
    "tallrik",
    "avdelning",
    "motor",
    "cell",
    "spendera",
    "skåp",
    "skillnad",
    "driva",
    "undersökning",
    "motor",
    "häst",
    "känslig",
    "djur",
    "större",
    "förhandling",
    "klick",
    "humör",
    "period",
    "ankomst",
    "uttryck",
    "semester",
    "upprepa",
    "damm",
    "garderob",
    "guld",
    "dålig",
    "segla",
    "kombination",
    "kläder",
    "betoning",
    "tull",
    "svart",
    "steg",
    "skola",
    "hoppa",
    "dokumentera",
    "professionell",
    "läpp",
    "kemisk",
    "främre",
    "vakna",
    "medan",
    "inuti",
    "titta",
    "rad",
    "ämne",
    "straff",
    "balans",
    "möjlig",
    "vuxen",
    "åt sidan",
    "prov",
    "överklagande",
    "bröllop",
    "djup",
    "kung",
    "tilldela",
    "fru",
    "blåsa",
    "plats",
    "läger",
    "musik",
    "säker",
    "gåva",
    "fel",
    "gissning",
    "agera",
    "skam",
    "drama",
    "kapital",
    "examen",
    "dum",
    "spela in",
    "ljud",
    "svänga",
    "roman",
    "minimum",
    "förhållande",
    "maskin",
    "form",
    "leda",
    "drift",
    "lön",
    "moln",
    "affär",
    "hit",
    "kapitel",
    "etapp",
    "kvantitet",
    "tillträde",
    "armén",
    "kedja",
    "trafik",
    "sparka",
    "analys",
    "flygplats",
    "tid",
    "semester",
    "filosofi",
    "boll",
    "bröst",
    "tack",
    "plats",
    "fjäll",
    "reklam",
    "röd",
    "förbi",
    "hyra",
    "återvända",
    "tur",
    "hus",
    "konstruktion",
    "netto",
    "inföding",
    "krig",
    "figur",
    "avgift",
    "spray",
    "användare",
    "smuts",
    "skott",
    "uppgift",
    "stick",
    "vän",
    "programvara",
    "främjande",
    "interaktion",
    "omge",
    "blockera",
    "ändamål",
    "öva",
    "konflikt",
    "rutin",
    "krav",
    "bonus",
    "hål",
    "ange",
    "junior",
    "ljuv",
    "fånga",
    "riva",
    "vika",
    "vägg",
    "redaktör",
    "liv",
    "placera",
    "pund",
    "respektera",
    "badrum",
    "täcka",
    "manus",
    "jobb",
    "lära",
    "födelse",
    "se",
    "lösa",
    "tema",
    "anställd",
    "tvivel",
    "marknadsföra",
    "utbildning",
    "tjäna",
    "återvinna",
    "tona",
    "skada",
    "miss",
    "union",
    "förståelse",
    "ko",
    "flod",
    "förening",
    "begrepp",
    "utbildning",
    "recept",
    "relation",
    "boka",
    "depression",
    "bevis",
    "hår",
    "inkomst",
    "oberoende",
    "lyfta",
    "uppdrag",
    "tillfällig",
    "belopp",
    "förlust",
    "kant",
    "spåra",
    "kontrollera",
    "rep",
    "uppskatta",
    "föroreningar",
    "stabil",
    "meddelande",
    "leverans",
    "perspektiv",
    "spegel",
    "assistent",
    "representant",
    "bevittna",
    "natur",
    "bedöma",
    "frukt",
    "dricks",
    "jäkel",
    "stad",
    "nödsituation",
    "övre",
    "släppa",
    "vistelse",
    "mänsklig",
    "hals",
    "högtalare",
    "nätverk",
    "sjunga",
    "motstå",
    "liga",
    "resa",
    "signatur",
    "advokat",
    "betydelse",
    "gas",
    "val",
    "ingenjör",
    "framgång",
    "del",
    "extern",
    "arbetstagare",
    "enkel",
    "kvartal",
    "student",
    "hjärta",
    "passera",
    "trots",
    "flytta",
    "grov",
    "lady",
    "gräs",
    "gemenskap",
    "garage",
    "ungdom",
    "standard",
    "kjol",
    "löfte",
    "blind",
    "tv",
    "sjukdom",
    "provision",
    "positiv",
    "energi",
    "lugna",
    "närvaro",
    "ställa in",
    "grund",
    "preferens",
    "huvud",
    "gemensam",
    "skära",
    "någonstans",
    "presentation",
    "nuvarande",
    "tanke",
    "rotation",
    "ansträngning",
    "bemästra",
    "genomföra",
    "republik",
    "golv",
    "princip",
    "främling",
    "axel",
    "kvalitet",
    "knapp",
    "tennis",
    "polis",
    "samling",
    "konto",
    "register",
    "handske",
    "dela",
    "professor",
    "stol",
    "prioritet",
    "kombinera",
    "fred",
    "förlängning",
    "kanske",
    "kväll",
    "ram",
    "syster",
    "våg",
    "koda",
    "ansökan",
    "mus",
    "match",
    "disk",
    "flaska",
    "halv",
    "kind",
    "upplösning",
    "tillbaka",
    "kunskap",
    "göra",
    "diskussion",
    "skruva",
    "längd",
    "olycka",
    "slåss",
    "klä",
    "knä",
    "logga",
    "paket",
    "det",
    "sväng",
    "hörsel",
    "tidning",
    "lager",
    "rikedom",
    "profil",
    "fantasi",
    "svar",
    "helgen",
    "lärare",
    "utseende",
    "möta",
    "cykel",
    "stiga",
    "bälte",
    "krascha",
    "skål",
    "ekvivalent",
    "stöd",
    "bild",
    "dikt",
    "risk",
    "spänning",
    "avlägsen",
    "sekreterare",
    "offentlig",
    "producera",
    "plan",
    "visa",
    "pengar",
    "sand",
    "situation",
    "stansa",
    "kund",
    "titel",
    "skaka",
    "inteckning",
    "alternativ",
    "antal",
    "pop",
    "fönster",
    "utsträckning",
    "ingenting",
    "uppleva",
    "omdöme",
    "avresa",
    "dansa",
    "indikation",
    "pojke",
    "material",
    "band",
    "ledare",
    "sol",
    "vacker",
    "muskel",
    "jordbrukare",
    "mängd",
    "fett",
    "hantera",
    "direktör",
    "möjlighet",
    "kalender",
    "utanför",
    "takt",
    "bad",
    "fisk",
    "följd",
    "sätta",
    "ägare",
    "gå",
    "läkare",
    "information",
    "dela",
    "skada",
    "skydd",
    "karriär",
    "finansiera",
    "tvinga",
    "golf",
    "skräp",
    "aspekt",
    "unge",
    "mat",
    "känga",
    "mjölk",
    "svara",
    "mål",
    "verklighet",
    "rå",
    "ringa",
    "köpcenter",
    "en",
    "inverkan",
    "område",
    "nyheter",
    "internationell",
    "serie",
    "imponera på",
    "mor",
    "skydd",
    "strejk",
    "lån",
    "månad",
    "plats",
    "något",
    "underhållning",
    "bekant",
    "ledtråd",
    "år",
    "glad",
    "stormarknad",
    "naturlig",
    "gud",
    "kosta",
    "konversation",
    "slips",
    "ruin",
    "bekvämlighet",
    "jorden",
    "storm",
    "procentsats",
    "bistånd",
    "budget",
    "styrka",
    "början",
    "sova",
    "andra",
    "ung",
    "enhet",
    "fylla",
    "lagra",
    "önskan",
    "dölja",
    "värde",
    "kopp",
    "underhåll",
    "sjuksköterska",
    "fungera",
    "torn",
    "roll",
    "klass",
    "kamera",
    "databas",
    "panik",
    "nation",
    "korg",
    "is",
    "konst",
    "anda",
    "diagram",
    "utbyta",
    "feed-back",
    "påstående",
    "rykte",
    "söka",
    "jaga",
    "utöva",
    "otäck",
    "varsel",
    "manlig",
    "gård",
    "årlig",
    "krage",
    "datum",
    "plattform",
    "plantera",
    "förmögenhet",
    "passion",
    "vänskap",
    "sprida",
    "cancer",
    "biljett",
    "attityd",
    "ö",
    "aktiv",
    "objekt",
    "service",
    "köpare",
    "bita",
    "kort",
    "ansikte",
    "stek",
    "förslag",
    "patient",
    "värme",
    "regel",
    "bosatt",
    "bred",
    "politik",
    "västerut",
    "kniv",
    "expert",
    "flicka",
    "design",
    "salt",
    "baseball",
    "hugg",
    "inspektion",
    "kusin",
    "par",
    "tidskrift",
    "laga mat",
    "beroende",
    "säkerhet",
    "kyckling",
    "version",
    "valuta",
    "stege",
    "schema",
    "kök",
    "sysselsättning",
    "lokal",
    "uppmärksamhet",
    "chef",
    "faktum",
    "täcka",
    "ledsen",
    "skydda",
    "relativ",
    "grevskap",
    "hastighet",
    "lunch",
    "programmera",
    "initiativ",
    "redskap",
    "bro",
    "bröst",
    "prata",
    "maträtt",
    "garanti",
    "öl",
    "fordon",
    "reception",
    "kvinna",
    "ämne",
    "kopiera",
    "föreläsning",
    "fördel",
    "parkera",
    "kall",
    "död",
    "blanda",
    "hålla",
    "skala",
    "i morgon",
    "blod",
    "begäran",
    "grön",
    "kaka",
    "kyrka",
    "remsa",
    "evigt",
    "utöver",
    "skuld",
    "tackla",
    "tvätta",
    "följande",
    "känsla",
    "maximal",
    "sektor",
    "hav",
    "egendom",
    "ekonomi",
    "meny",
    "bänk",
    "försök",
    "språk",
    "start",
    "samtal",
    "fast",
    "adress",
    "inkomst",
    "fot",
    "senior",
    "honung",
    "få",
    "blandning",
    "kontanter",
    "livsmedelsbutik",
    "länk",
    "karta",
    "form",
    "faktor",
    "pott",
    "modell",
    "författare",
    "odla",
    "vinter",
    "skicklighet",
    "någonstans",
    "födelsedag",
    "politik",
    "släppa",
    "man",
    "labb",
    "skynda",
    "post",
    "utrustning",
    "sjunka",
    "par",
    "förare",
    "hänsyn",
    "läder",
    "hud",
    "blå",
    "båt",
    "försäljning",
    "tegel",
    "två",
    "foder",
    "fyrkant",
    "punkt",
    "rusa",
    "dröm",
    "plats",
    "eftermiddag",
    "tillverkare",
    "kontrollera",
    "tillfälle",
    "problem",
    "introduktion",
    "råd",
    "slå vad",
    "äta",
    "döda",
    "kategori",
    "sätt",
    "kontor",
    "egendom",
    "stolthet",
    "medvetenhet",
    "glida",
    "spricka",
    "klient",
    "spika",
    "skjuta",
    "medlemskap",
    "mjuk",
    "någon",
    "web",
    "officiell",
    "enskild",
    "pizza",
    "intressera",
    "väska",
    "stava",
    "yrke",
    "drottning",
    "handla",
    "resurs",
    "fartyg",
    "kille",
    "choklad",
    "gemensam",
    "formell",
    "på övervåningen",
    "bil",
    "tillflykt",
    "utomlands",
    "-handlare",
    "associera",
    "finger",
    "kirurgi",
    "kommentar",
    "team",
    "detalj",
    "galen",
    "väg",
    "berättelse",
    "första",
    "ärm",
    "radio",
    "efterfrågan",
    "enda",
    "dra",
    "gul",
    "tävling",
    "bit",
    "citationstecken",
    "dra",
    "kommersiell",
    "skjorta",
    "bidrag",
    "grädde",
    "kanal",
    "kostym",
    "disciplin",
    "instruktion",
    "konsert",
    "tal",
    "låg",
    "effektiv",
    "hänga",
    "repa",
    "industri",
    "frukost",
    "lägga",
    "ansluta sig till",
    "metall",
    "sovrum",
    "minut",
    "produkt",
    "vila",
    "temperatur",
    "många",
    "ge",
    "argument",
    "skriva ut",
    "purpur",
    "skratta",
    "hälsa",
    "kreditera",
    "investering",
    "sälja",
    "miljö",
    "lektion",
    "ägg",
    "mitten",
    "äktenskap",
    "nivå",
    "bevis",
    "fras",
    "kärlek",
    "själv",
    "förmån",
    "vägledning",
    "påverka",
    "du",
    "pappa",
    "ångest",
    "särskild",
    "pojkvän",
    "testa",
    "tom",
    "betalning",
    "soppa",
    "skyldighet",
    "svar",
    "leende",
    "djup",
    "klagomål",
    "tillägg",
    "recension",
    "låda",
    "handduk",
    "mindre",
    "gyckel",
    "jord",
    "utfärda",
    "cigarett",
    "internet",
    "få",
    "berätta",
    "inträde",
    "skona",
    "incident",
    "familj",
    "vägra",
    "gren",
    "burk",
    "penna",
    "farfar",
    "konstant",
    "tank",
    "farbror",
    "klimat",
    "jord",
    "volym",
    "kommunikation",
    "slag",
    "poet",
    "barn",
    "skärm",
    "mina",
    "sluta",
    "gen",
    "brist",
    "välgörenhet",
    "minne",
    "tand",
    "rädsla",
    "nämna",
    "marknadsföring",
    "avslöja",
    "resonera",
    "domstol",
    "säsong",
    "frihet",
    "landa",
    "sport",
    "publik",
    "klassrum",
    "lag",
    "krok",
    "vinna",
    "bära",
    "öga",
    "lukt",
    "distribution",
    "forskning",
    "land",
    "våga",
    "hoppas",
    "medan",
    "sträcka",
    "bibliotek",
    "om",
    "dröjsmål",
    "college",
    "plast",
    "boka",
    "presentera",
    "använda",
    "oroa",
    "mästare",
    "mål",
    "ekonomi",
    "mars",
    "val",
    "reflexion",
    "midnatt",
    "glida",
    "inflation",
    "handling",
    "utmaning",
    "gitarr",
    "kust",
    "äpple",
    "kampanj",
    "fält",
    "jacka",
    "känsla",
    "sätt",
    "visuell",
    "ta bort",
    "väder",
    "skräp",
    "kabel",
    "ångra",
    "kompis",
    "strand",
    "historiker",
    "mod",
    "sympati",
    "lastbil",
    "spänning",
    "tillåta",
    "näsa",
    "säng",
    "son",
    "person",
    "bas",
    "kött",
    "vanliga",
    "luft",
    "möte",
    "värde",
    "spel",
    "oberoende",
    "fysisk",
    "kort",
    "spela",
    "höja",
    "styrelse",
    "hon",
    "nyckel",
    "handstil",
    "plocka",
    "kommando",
    "part",
    "i går",
    "fjädra",
    "kandidat",
    "fysik",
    "universitet",
    "oro",
    "utveckling",
    "ändra",
    "sträng",
    "mål",
    "exempel",
    "rum",
    "bitter",
    "fågel",
    "fotboll",
    "normal",
    "split",
    "intryck",
    "trä",
    "lång",
    "menande",
    "stock",
    "lock",
    "ledarskap",
    "media",
    "ambition",
    "fiske",
    "uppsats",
    "sallad",
    "reparera",
    "i dag",
    "designer",
    "natt",
    "bank",
    "ritning",
    "oundviklig",
    "fas",
    "omfattande",
    "chips",
    "ilska",
    "växla",
    "gråta",
    "vrida",
    "personlighet",
    "försök",
    "lagring",
    "varelse",
    "förberedelse",
    "slagträ",
    "urval",
    "vit",
    "teknologi",
    "kontrakt",
    "sida",
    "avsnitt",
    "station",
    "till",
    "strukturera",
    "tunga",
    "smak",
    "sanning",
    "svårighet",
    "grupp",
    "begränsa",
    "huvud",
    "flytta",
    "känsla",
    "ljus",
    "exempel",
    "uppdrag",
    "makt",
    "vänta",
    "hjul",
    "handla",
    "värd",
    "klassisk",
    "alternativ",
    "orsaka",
    "ombud",
    "bestå",
    "tabell",
    "flygbolag",
    "text",
    "slå samman",
    "hantverk",
    "räckvidd",
    "bränsle",
    "verktyg",
    "partner",
    "ladda",
    "ingång",
    "deposition",
    "hat",
    "artikel",
    "video",
    "sommar",
    "särdrag",
    "extrem",
    "mobil",
    "sjukhus",
    "flyg",
    "falla",
    "pension",
    "piano",
    "misslyckas",
    "resultat",
    "gnugga",
    "gap",
    "system",
    "rapportera",
    "suga",
    "vanlig",
    "vind",
    "nerv",
    "be",
    "glans",
    "notera",
    "linje",
    "mamma",
    "uppfattning",
    "bror",
    "hänvisning",
    "böja",
    "avgift",
    "behandla",
    "lura",
    "kalla",
    "läxa",
    "baka",
    "bud",
    "status",
    "projekt",
    "strategi",
    "orange",
    "låta",
    "entusiasm",
    "förälder",
    "koncentrera",
    "anordning",
    "resa",
    "poesi",
    "företag",
    "samhälle",
    "kyssa",
    "avsluta",
    "vegetabilisk",
    "använda",
    "schema",
    "timme",
    "modig",
    "fokus",
    "behandla",
    "film",
    "olaglig",
    "allmän",
    "kaffe",
    "annons",
    "motorväg",
    "kemi",
    "psykologi",
    "hyra",
    "klocka",
    "konferens",
    "lättnad",
    "visa",
    "snygg",
    "rolig",
    "vikt",
    "kvalitet",
    "klubb",
    "dotter",
    "zon",
    "röra",
    "i kväll",
    "chock",
    "bränna",
    "ursäkt",
    "namn",
    "undersökning",
    "landskap",
    "förskott",
    "tillfredsställelse",
    "bröd",
    "katastrof",
    "punkt",
    "hatt",
    "tidigare",
    "shopping",
    "besök",
    "öster",
    "bild",
    "hem",
    "aning",
    "far",
    "jämförelse",
    "katt",
    "rör",
    "vinnare",
    "räkna",
    "sjö",
    "bekämpa",
    "pris",
    "grund",
    "hund",
    "hålla",
    "idealisk",
    "fläkt",
    "kamp",
    "topp",
    "säkerhet",
    "lösning",
    "helvete",
    "slutsats",
    "befolkning",
    "anstränga",
    "larm",
    "mått",
    "andra",
    "tåg",
    "ras",
    "förfallen",
    "försäkring",
    "chef",
    "träd",
    "övervaka",
    "sjuk",
    "kurs",
    "dra",
    "utnämning",
    "skiva",
    "fortfarande",
    "vård",
    "tålamod",
    "rik",
    "fly",
    "känsla",
    "kunglig",
    "kvinnlig",
    "barndom",
    "regering",
    "bild",
    "vilja",
    "socka",
    "stor",
    "gate",
    "olja",
    "korsa",
    "stift",
    "förbättring",
    "mästerskap",
    "dumbom",
    "hjälp",
    "sky",
    "tonhöjd",
    "man",
    "diamant",
    "mest",
    "övergång",
    "arbete",
    "vetenskap",
    "utskott",
    "ögonblick",
    "fixera",
    "undervisning",
    "gräva",
    "specialist",
    "komplex",
    "guide",
    "personer",
    "död",
    "röst",
    "original",
    "bryta",
    "ämne",
    "data",
    "grad",
    "läsning",
    "inspelning",
    "knippa",
    "nå",
    "dom",
    "lögn",
    "regelbunden",
    "uppsättning",
    "målning",
    "läge",
    "lista",
    "spelare",
    "björn",
    "norr",
    "undra",
    "matta",
    "tung",
    "officer",
    "negativ",
    "klocka",
    "unik",
    "baby",
    "smärta",
    "antagande",
    "disk",
    "järn",
    "fakturera",
    "låda",
    "titt",
    "dubbel",
    "misstag",
    "avsluta",
    "framtida",
    "lysande",
    "kontakta",
    "matematik",
    "ris",
    "lämna",
    "restaurang",
    "rabatt",
    "sex",
    "virus",
    "bit",
    "förtroende",
    "händelse",
    "bära",
    "juice",
    "fel",
    "bugga",
    "sammanhang",
    "lera",
    "hela",
    "sjal",
    "avsikt",
    "förslag",
    "tryck",
    "tårta",
    "mörk",
    "förklaring",
    "utrymme",
    "vinkel",
    "ord",
    "effektivitet",
    "förvaltning",
    "vana",
    "stjärna",
    "chans",
    "fynd",
    "transport",
    "stå",
    "kritik",
    "flöde",
    "dörr",
    "skada",
    "insekt",
    "överraskning",
    "lägenhet",
]  # pylint: disable=line-too-long

# ISO 639-1 codes to language names.
LANGUAGE_CODES = immutabledict.immutabledict(
    {
        "en": "English",
        "es": "Spanish",
        "pt": "Portuguese",
        "ar": "Arabic",
        "hi": "Hindi",
        "fr": "French",
        "ru": "Russian",
        "de": "German",
        "ja": "Japanese",
        "it": "Italian",
        "bn": "Bengali",
        "uk": "Ukrainian",
        "th": "Thai",
        "ur": "Urdu",
        "ta": "Tamil",
        "te": "Telugu",
        "bg": "Bulgarian",
        "ko": "Korean",
        "pl": "Polish",
        "he": "Hebrew",
        "fa": "Persian",
        "vi": "Vietnamese",
        "ne": "Nepali",
        "sw": "Swahili",
        "kn": "Kannada",
        "mr": "Marathi",
        "gu": "Gujarati",
        "pa": "Punjabi",
        "ml": "Malayalam",
        "fi": "Finnish",
    }
)

_ALPHABETS = "([A-Za-z])"
# _PREFIXES = "(Mr|St|Mrs|Ms|Dr)[.]"
_PREFIXES = "(Herr|St|Mrs|Ms|Dr)[.]" 
_SUFFIXES = "(Inc|Ltd|Jr|Sr|Co|Oy)"
#_STARTERS = r"(Mr|Mrs|Ms|Dr|Prof|Capt|Cpt|Lt|He\s|She\s|It\s|They\s|Their\s|Our\s|We\s|But\s|However\s|That\s|This\s|Wherever)"
_STARTERS = r"(Herr|Mrs|Ms|Dr|Prof|Kapten|Kpt|Lt|Han\s|Hon\s|Det\s|Deras\s|Vår\s|Vi|Men\s|Dock\s|Det är\s|Detta\s|Varhelst)"
_ACRONYMS = "([A-Z][.][A-Z][.](?:[A-Z][.])?)"
_WEBSITES = "[.](com|net|org|io|gov|edu|me|fi|sv|eu)"
_DIGITS = "([0-9])"
_MULTIPLE_DOTS = r"\.{2,}"


def split_into_sentences(text):
    """Split the text into sentences.

    Args:
      text: A string that consists of more than or equal to one sentences.

    Returns:
      A list of strings where each string is a sentence.
    """
    text = " " + text + "  "
    text = text.replace("\n", " ")
    text = re.sub(_PREFIXES, "\\1<prd>", text)
    text = re.sub(_WEBSITES, "<prd>\\1", text)
    text = re.sub(_DIGITS + "[.]" + _DIGITS, "\\1<prd>\\2", text)
    text = re.sub(
        _MULTIPLE_DOTS,
        lambda match: "<prd>" * len(match.group(0)) + "<stop>",
        text,
    )
    if "Ph.D" in text:
        text = text.replace("Ph.D.", "Ph<prd>D<prd>")
    text = re.sub(r"\s" + _ALPHABETS + "[.] ", " \\1<prd> ", text)
    text = re.sub(_ACRONYMS + " " + _STARTERS, "\\1<stop> \\2", text)
    text = re.sub(
        _ALPHABETS + "[.]" + _ALPHABETS + "[.]" + _ALPHABETS + "[.]",
        "\\1<prd>\\2<prd>\\3<prd>",
        text,
    )
    text = re.sub(_ALPHABETS + "[.]" + _ALPHABETS + "[.]", "\\1<prd>\\2<prd>", text)
    text = re.sub(" " + _SUFFIXES + "[.] " + _STARTERS, " \\1<stop> \\2", text)
    text = re.sub(" " + _SUFFIXES + "[.]", " \\1<prd>", text)
    text = re.sub(" " + _ALPHABETS + "[.]", " \\1<prd>", text)
    if "”" in text:
        text = text.replace(".”", "”.")
    if '"' in text:
        text = text.replace('."', '".')
    if "!" in text:
        text = text.replace('!"', '"!')
    if "?" in text:
        text = text.replace('?"', '"?')
    text = text.replace(".", ".<stop>")
    text = text.replace("?", "?<stop>")
    text = text.replace("!", "!<stop>")
    text = text.replace("<prd>", ".")
    sentences = text.split("<stop>")
    sentences = [s.strip() for s in sentences]
    if sentences and not sentences[-1]:
        sentences = sentences[:-1]
    return sentences


def count_words(text):
    """Counts the number of words."""
    tokenizer = nltk.tokenize.RegexpTokenizer(r"\w+")
    tokens = tokenizer.tokenize(text)
    num_words = len(tokens)
    return num_words


@functools.lru_cache(maxsize=None)
def _get_sentence_tokenizer():
    return nltk.data.load("nltk:tokenizers/punkt/english.pickle")


def count_sentences(text):
    """Count the number of sentences."""
    tokenizer = _get_sentence_tokenizer()
    tokenized_sentences = tokenizer.tokenize(text)
    return len(tokenized_sentences)


def generate_keywords(num_keywords):
    """Randomly generates a few keywords."""
    return random.sample(WORD_LIST, k=num_keywords)
